name: autolamella-task-protocol
description: a description of the protocol
version: 0.1
tasks:
  - name: Mill Trench
    description: mill trenches around region of interest at high curerent
    supervise: true
    parameters: # dict
      orientation: FIB
    milling:
    -   name: Trench 01
        milling:
          application_file: Si
          hfw: 0.00018
          milling_current: 7.6e-09
          milling_voltage: 30000
          preset: 30 keV; 2.5 nA
        pattern:
            depth: 1.25e-06
            lower_trench_height: 3.2e-05
            name: Trench
            spacing: 2.5e-05
            upper_trench_height: 1.6e-05
            width: 2.2e-05
        strategy: {}
  - name: Mill Undercut
    description: mill regions underneath the lamella at an oblique angle
    supervise: true
    parameters: # dict
      undercut_tilt_angle: -5 # deg
      orientation: SEM
    milling:
    -   name: Undercut 01
        milling:
          application_file: Si
          hfw: 8.0e-05
          milling_current: 7.6e-09
        pattern:
            depth: 1.2e-06
            height: 1.6e-05
            name: Rectangle
            width: 2.2e-05
        strategy: {}
    -   name: Undercut 02
        milling:
            application_file: Si
            hfw: 8.0e-05
            milling_current: 7.6e-09
        pattern:
            depth: 1.2e-06
            height: 8.0e-06
            name: Rectangle
            width: 2.2e-05
        strategy: {}
  - name: Setup Lamella
    description: select lamella position and milling pattern position
    supervise: true
    parameters: # dict
      milling_angle: 15 # deg
    milling:    # list[dict]
    - name: Fiducial  
      milling:
        application_file: Si
        hfw: 8.0e-05
        milling_current: 2.0e-09
        preset: 30 keV; 20 nA
      pattern:
          depth: 1.0e-06
          height: 1.0e-05
          name: Fiducial
          passes: null
          rotation: 45
          width: 1.0e-06
          point: {"x": 25.0e-6, "y": 0.0e-6}
      strategy: {}
  - name: Rough Milling
    description: mill rough lamella trenches, and stress relief features
    supervise: true
    parameters: # dict
    milling:    # list[dict]
    -   name: MicroExpansion
        milling:
            application_file: Si
            hfw: 200e-6
            milling_current: 2.0e-09
            preset: 30 keV; 2.5 nA
        pattern:
            depth: 1.0e-06
            distance: 1.0e-05
            height: 1.8e-05
            name: MicroExpansion
            width: 5.0e-07
        strategy: {}
    -   name: Notch 01
        milling:
            application_file: Si-ccs
            hfw: 80e-6
            milling_current: 2.0e-09
            preset: 30 keV; 2.5 nA
        pattern:
            depth: 2.5e-06
            distance: 2.0e-06
            flip: 0
            hheight: 2.0e-07
            hwidth: 4.0e-06
            name: WaffleNotch
            vheight: 2.0e-06
            vwidth: 2.0e-07
            point: {"x": 7.0e-6, "y": 0.0e-6}
        strategy: {}
    -   name: Rough Mill 01
        milling:
            application_file: Si-ccs
            hfw: 8.0e-05
            milling_current: 7.4e-10
        pattern:
            cross_section: CleaningCrossSection
            depth: 6.5e-07
            lower_trench_height: 3.5e-06
            name: Trench
            spacing: 4.6e-06
            upper_trench_height: 3.5e-06
            width: 1.0e-05
        strategy: {}
    -   name: Rough Mill 02
        milling:
            application_file: Si-ccs
            hfw: 8.0e-05
            milling_current: 2.0e-10
            patterning_mode: Serial
        pattern:
            cross_section: CleaningCrossSection
            depth: 6.5e-07
            lower_trench_height: 2.0e-06
            name: Trench
            spacing: 1.6e-06
            upper_trench_height: 2.0e-06
            width: 9.5e-06
        strategy: {}
  - name: Spot Burn Fiducial
    description: mill spot fiducial markers for correlation 
    parameters: # dict
      supervise: true
      milling_current: 60.0e-12 # A
      exposure_time: 10         # s
      orientation: FIB
  - name: Fluorescence Acquisition
    description: acquire fluorescence image of the lamella
    parameters: # dict
      supervise: true
      orientation: FM
      channels: 
        - name: channel-1
          emission_wavelength: 420
          excitation_wavelength: 488
          exposure_time: 0.1
          gain: 1.0
          binning: 2x2
        - name: channel-2
          emission_wavelength: null
          excitation_wavelength: 488
          exposure_time: 0.5
          gain: 1.0
          binning: 2x2
      zparams: {zmin: -10.0e-6, zmax: 10.0e-6, zstep: 1.0e-6}
  - name: Polishing
    description: final low current polishing of the lamella
    supervise: true
    parameters: # dict
      acquire_final_image: true
    milling:    # list[dict]
    -   name: Polishing Mill 01
        milling:
            application_file: Si-ccs
            hfw: 8.0e-05
            milling_current: 6.0e-11
            patterning_mode: Serial
        pattern:
            cross_section: CleaningCrossSection
            depth: 4.0e-07
            lower_trench_height: 7.0e-07
            name: Trench
            spacing: 4.5e-07
            upper_trench_height: 7.0e-07
            width: 9.0e-06
        strategy: {}
    -   name: Polishing Mill 02   
        milling:
            application_file: Si-ccs
            hfw: 8.0e-05
            milling_current: 6.0e-11
            patterning_mode: Serial
        pattern:
            cross_section: CleaningCrossSection
            depth: 4.0e-07
            lower_trench_height: 2.5e-07
            name: Trench
            spacing: 3.0e-07
            upper_trench_height: 2.5e-07
            width: 9.0e-06
        strategy: {}

grid-tasks:
  - name: Overview Acquisition
    description: acquire overview image of the grid
    supervise: false
    parameters: # dict
      orientation: SEM
      image:
        name: overview-image
        resolution: [1024, 1024]
        dwell_time: 1.0e-6
        beam_type: SEM
        hfw: 500.e-6
  - name: Cryo GIS Deposition
    description: whole grid cryogenic deposition
    supervise: true
    parameters: # dict
      position: cryo-deposition
      time: 30 # s
  - name: Cryo Sputter Coating
    description: whole grid cryogenic sputter coating
    supervise: true
    parameters: # dict
      position: cryo-sputter
      time: 30 # s
  - name: Parallel Trench Milling
    description: a description of the task
    supervise: true
    parameters: # dict
      # QUERY: should this be a different kind of task? or just a parameter?
      # maybe this should just be an execution -> E.g. Execute in Parallel

# microscope configuration? global?
configuration:
  fib:
    plasma: Xenon



# TASK REGISTRY
# How to define a task?
# How to associate tasks with a function?
# How to define task parameters for a function?
# Do all tasks have the same parameters?
# How to differentiate between tasks performed on the grid, a single lamella vs a batch?
# How to register pre-requisites for a task? optional tasks?
# How to define a workflow?
# How to differentiate between per-lamella tasks and per-grid tasks?
